<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>StudyFlow â€” Ù†Ø³Ø®Ø© ÙƒØ§Ù…Ù„Ø© Ø¨Ù…Ù„Ù ÙˆØ§Ø­Ø¯</title>
<style>
:root{--indigo:#6366f1;--violet:#8b5cf6;--bg:#f7f7ff;--card:#ffffff;--text:#0f172a;--muted:#64748b;--border:#e2e8f0;--green:#10b981;--slate:#0f172a}
html.dark{--bg:#0b1220;--card:#0f172a;--text:#f1f5f9;--muted:#94a3b8;--border:#1e293b}
*{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto}
a{color:inherit} .bg{background:linear-gradient(#fff,var(--bg))}
.container{max-width:1120px;margin:0 auto;padding:16px}
.topbar{position:sticky;top:0;z-index:40;backdrop-filter:blur(10px);background:rgba(255,255,255,.7);border-bottom:1px solid var(--border)}
html.dark .topbar{background:rgba(15,23,42,.7)}
.row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,var(--indigo),var(--violet));color:#fff;display:grid;place-items:center;font-weight:800}
.btn{border:1px solid var(--border);background:var(--card);color:var(--text);border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:600;transition:.2s}
.btn:hover{transform:translateY(-1px)} .btn.primary{background:linear-gradient(135deg,var(--indigo),var(--violet));color:#fff;border:none}
.pill{border:1px solid var(--border);border-radius:999px;padding:6px 10px;display:inline-flex;gap:6px;align-items:center;font-size:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.04)}
.title{font-weight:700} .muted{color:var(--muted);font-size:12px}
.grid{display:grid;gap:12px} .grid-2{grid-template-columns:1fr 1fr} .grid-3{grid-template-columns:repeat(3,1fr)} .grid-4{grid-template-columns:repeat(4,1fr)}
@media(max-width:1000px){.grid-4{grid-template-columns:1fr 1fr}}
@media(max-width:900px){.grid-3{grid-template-columns:1fr}.grid-2{grid-template-columns:1fr}}
.section{margin-top:12px}.hidden{display:none}.right{margin-inline-start:auto}
.grade{padding:12px;border:1px solid var(--border);border-radius:16px;background:var(--card);text-align:center;cursor:pointer;transition:.2s}
.grade.active{outline:2px solid #a5b4fc;background:linear-gradient(0deg, rgba(99,102,241,.08), transparent)}
.subject{padding:10px 12px;border:1px solid var(--border);border-radius:14px;background:var(--card);cursor:pointer;transition:.2s}
.subject.active{background:#4f46e5;color:#fff;border-color:#4f46e5}
.range{width:100%}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:var(--slate);color:#fff;padding:8px 12px;border-radius:12px;font-size:12px;z-index:60}
.confetti{position:fixed;inset:0;pointer-events:none;z-index:100}
@keyframes pop{from{transform:scale(.96);opacity:.5}to{transform:scale(1);opacity:1}} .pop{animation:pop .25s ease}
.footer{padding:40px 0;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body class="bg">
<header class="topbar">
  <div class="container row" style="padding:10px 16px">
    <div class="row" style="gap:8px">
      <div class="logo">SF</div>
      <div class="title">StudyFlow</div>
      <span class="pill" id="streakPill">ğŸ”¥ 0</span>
      <span class="pill" id="badgesPill">ğŸ… 0</span>
    </div>
    <div class="row" style="gap:8px">
      <button class="btn" id="langBtn">AR/EN</button>
      <button class="btn" id="themeBtn">Dark/Light</button>
      <span class="pill">â˜… <b id="points">0</b></span>
      <button class="btn" id="openStore">Ø§Ù„Ù…ØªØ¬Ø±</button>
      <button class="btn" id="openSettings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>
  </div>
</header>

<main class="container" style="padding-top:14px">
  <!-- Onboarding -->
  <section id="onboarding" class="card pop">
    <div id="ob0">
      <div class="title">Ù…Ø±Ø­Ø¨Ù‹Ø§! ğŸ‘‹</div>
      <div class="muted">Ù…Ù†ØµØ© ØªÙ†Ø¸Ù‘Ù… ÙˆÙ‚ØªÙƒ ÙˆØªÙƒØ´Ù Ù†Ù‚Ø§Ø· Ø¶Ø¹ÙÙƒ ÙˆØªÙƒØ§ÙØ¦Ùƒ Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·.</div>
      <div class="grid grid-3 section">
        <div class="card"><b>Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø°ÙƒÙŠØ©</b><div class="muted">Ù†ÙˆØ²Ù‘Ø¹ Ø£Ø³Ø¨ÙˆØ¹Ùƒ Ø­Ø³Ø¨ Ø§Ù„Ø£Ø¶Ø¹Ù</div></div>
        <div class="card"><b>Pomodoro</b><div class="muted">Ø¬Ù„Ø³Ø§Øª 25 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø¹ Ù†Ù‚Ø§Ø·</div></div>
        <div class="card"><b>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø±ÙŠØ¹Ø©</b><div class="muted">Ø¨Ø·Ø§Ù‚Ø§Øª SRS Ø£Ø³Ø§Ø³ÙŠØ©</div></div>
      </div>
      <div class="title section">Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</div>
      <div id="gradeList" class="grid grid-4 section"></div>
      <div class="row section">
        <button class="btn primary right" id="next0">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>
    </div>

    <div id="ob1" class="hidden">
      <div class="title">Ø§Ø®ØªØ± Ù…ÙˆØ§Ø¯Ùƒ</div>
      <div id="subjList" class="grid grid-3 section"></div>
      <div class="row section">
        <button class="btn" id="back1">Ø±Ø¬ÙˆØ¹</button>
        <button class="btn primary right" id="next1">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>
    </div>

    <div id="ob2" class="hidden">
      <div class="title">Ù‚ÙŠÙ‘Ù… Ù…Ø³ØªÙˆØ§Ùƒ (1 Ø¶Ø¹ÙŠÙ â€“ 5 Ù…Ù…ØªØ§Ø²)</div>
      <div id="ratingList" class="grid section"></div>
      <div class="row section">
        <button class="btn" id="back2">Ø±Ø¬ÙˆØ¹</button>
        <button class="btn primary right" id="next2">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>
    </div>

    <div id="ob3" class="hidden">
      <div class="title">ÙˆÙ‚Øª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
      <div class="row section" style="gap:10px">
        <input id="minutes" class="range" type="range" min="25" max="120" step="5" value="50">
        <span class="pill"><span id="minVal">50</span> Ø¯Ù‚ÙŠÙ‚Ø©</span>
      </div>
      <div class="muted">Ø³Ù†Ù‚Ø³Ù‘Ù… Ø§Ù„ÙˆÙ‚Øª Ù„Ø¬Ù„Ø³Ø§Øª 25 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø¹ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø¶Ø¹Ù.</div>
      <div class="row section">
        <button class="btn" id="back3">Ø±Ø¬ÙˆØ¹</button>
        <button class="btn primary right" id="finish">Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø·Ø©</button>
      </div>
    </div>
  </section>

  <!-- Dashboard -->
  <section id="dash" class="hidden pop">
    <div class="grid grid-3">
      <div class="card">
        <div class="title">Ù…Ø§Ø°Ø§ Ø³Ø£ÙØ¹Ù„ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
        <div class="muted">Ø¬Ù„Ø³Ø© ØªØ±ÙƒÙŠØ² 25Ø¯ â€¢ Ø£Ù‚Ø±Ø¨ Ù…Ù‡Ù…Ø© â€¢ Ø±ØµÙŠØ¯ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</div>
        <div class="row section">
          <button class="btn primary" id="startPomodoro">Ø§Ø¨Ø¯Ø£ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¢Ù†</button>
          <button class="btn" id="planWeek">ØªØ­Ø¯ÙŠØ« Ø®Ø·Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
        </div>
      </div>

      <div class="card">
        <div class="title">Ø§Ù„Ù…Ù‡Ø§Ù…</div>
        <div id="tasks"></div>
      </div>

      <div class="card">
        <div class="title">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>
        <div class="grid grid-3 section">
          <div class="card"><div class="muted">Ø¯Ù‚Ø§Ø¦Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div><b id="kpiMin">0</b></div>
          <div class="card"><div class="muted">Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø®Ø·Ø©</div><b id="kpiRate">0%</b></div>
          <div class="card"><div class="muted">Ø§Ù„Ù†Ù‚Ø§Ø·</div><b id="kpiPts">0</b></div>
        </div>
      </div>
    </div>

    <div class="card section">
      <div class="title">Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (7 Ø£ÙŠØ§Ù…)</div>
      <div id="calendar" class="grid"></div>
    </div>

    <div class="card section">
      <div class="title">Pomodoro (ØªØ¬Ø±ÙŠØ¨ÙŠ 25 Ø«Ø§Ù†ÙŠØ©)</div>
      <div class="row" style="gap:10px">
        <div class="pill" id="time">00:25</div>
        <button class="btn primary" id="toggleTimer">Ø§Ø¨Ø¯Ø£</button>
        <button class="btn" id="resetTimer">Ø¥Ø¹Ø§Ø¯Ø©</button>
      </div>
    </div>

    <div class="card section" id="storeCard">
      <div class="row">
        <div class="title">Ø§Ù„Ù…ØªØ¬Ø±</div>
        <span class="pill right">Ø§Ù„Ø±ØµÙŠØ¯: <b id="balance">0</b></span>
      </div>
      <div id="storeItems" class="grid grid-3 section"></div>
    </div>

    <div class="card section hidden" id="settingsCard">
      <div class="row">
        <div class="title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
        <button class="btn right" id="closeSettings">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="grid grid-2 section">
        <div>
          <div class="muted">Ø§Ù„Ø§Ø³Ù…</div>
          <input id="nameInput" class="btn" style="width:100%" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ">
        </div>
        <div>
          <div class="muted">Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø¤Ù‚Øª</div>
          <select id="speed" class="btn" style="width:100%">
            <option value="demo">ØªØ¬Ø±ÙŠØ¨ÙŠ (25 Ø«Ø§Ù†ÙŠØ©)</option>
            <option value="real">Ø­Ù‚ÙŠÙ‚ÙŠ (25 Ø¯Ù‚ÙŠÙ‚Ø©)</option>
          </select>
        </div>
      </div>
      <div class="row section">
        <button class="btn" id="saveSettings">Ø­ÙØ¸</button>
        <button class="btn" id="resetAll">Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      </div>
    </div>
  </section>
</main>

<div id="confetti" class="confetti"></div>
<div id="toast" class="toast hidden"></div>
<footer class="footer">StudyFlow Â© <span id="year"></span> â€¢ One-file Demo â€¢ Local only</footer>

<script>
// === Helpers ===
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const storeKey='sf_onefile_v3';
const todayISO=(d=new Date())=>{const o=d.getTimezoneOffset();const l=new Date(d.getTime()-o*60000);return l.toISOString().slice(0,10)}
const addDays=(d,n)=>{const x=new Date(d);x.setDate(x.getDate()+n);return x}
function toast(msg){const t=$('#toast'); t.textContent=msg; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'),1800)}
function confetti(emoji='ğŸ‰'){const root=$('#confetti');root.innerHTML='';for(let i=0;i<28;i++){const s=document.createElement('div');s.textContent=Math.random()<.33?'âœ¨':emoji;Object.assign(s.style,{position:'fixed',left:Math.random()*100+'%',top:'-10px',fontSize:12+Math.random()*16+'px',transition:`transform ${900+Math.random()*1000}ms cubic-bezier(.2,.8,.2,1), opacity 1400ms`,transform:'translateY(0px)',opacity:'1'});root.appendChild(s);requestAnimationFrame(()=>{s.style.transform=`translateY(${window.innerHeight+40}px) rotate(${Math.random()*180-90}deg)`;s.style.opacity='0'});setTimeout(()=>s.remove(),1800)}}

// === State ===
let state = JSON.parse(localStorage.getItem(storeKey)||'null') || {
  profile:{name:'Ø±Ø§Ø´Ø¯', demoSpeed:true, grade:null},
  lang:'ar', theme:'light',
  points:40, badges:[], streak:{days:0,last:todayISO()},
  store:{balance:40, items:[
    {id:'th1', title:'Ø«ÙŠÙ… Ø£Ø²Ø±Ù‚ Pro', type:'theme', cost:80},
    {id:'b1', title:'Boost x2 (24h)', type:'boost', cost:120},
    {id:'s1', title:'Ø£ØµÙˆØ§Øª ØªØ±ÙƒÙŠØ² LoFi', type:'sound', cost:70},
    {id:'m1', title:'ØµÙ†Ø¯ÙˆÙ‚ Ù…ÙØ§Ø¬Ø¢Øª', type:'mystery', cost:100},
  ], owned:[]},
  subjects:[], calendar:[], sessions:[]
};
function save(){localStorage.setItem(storeKey, JSON.stringify(state)); renderAll()}

// Lang/Theme
function setLang(l){state.lang=l; document.documentElement.lang=l; document.documentElement.dir=l==='ar'?'rtl':'ltr'; save()}
function setTheme(t){state.theme=t; document.documentElement.classList.toggle('dark', t==='dark'); save()}
$('#langBtn').onclick=()=> setLang(state.lang==='ar'?'en':'ar');
$('#themeBtn').onclick=()=> setTheme(state.theme==='dark'?'light':'dark');

// Onboarding data
const GRADES=Array.from({length:6},(_,i)=>({id:'G'+(7+i),label:'Grade '+(7+i)}));
const SUBJECTS=['Ø±ÙŠØ§Ø¶ÙŠØ§Øª','ÙÙŠØ²ÙŠØ§Ø¡','ÙƒÙŠÙ…ÙŠØ§Ø¡','Ø£Ø­ÙŠØ§Ø¡','Ø¹Ø±Ø¨ÙŠ','Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ','ØªØ§Ø±ÙŠØ®','Ø­Ø§Ø³ÙˆØ¨'];
let selectedGrade=state.profile.grade||'Grade 10';
let selectedSubjects=state.subjects.length? state.subjects.map(s=>s.name):['Ø±ÙŠØ§Ø¶ÙŠØ§Øª','ÙÙŠØ²ÙŠØ§Ø¡','Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ'];
let ratings={};

// Onboarding UI
function step(n){['#ob0','#ob1','#ob2','#ob3'].forEach((id,i)=> $(id).classList.toggle('hidden',i!==n))}
function mountGrades(){
  const box=document.getElementById('gradeList'); box.innerHTML='';
  GRADES.forEach(g=>{
    const el=document.createElement('div');
    el.className='grade'+(selectedGrade===g.label?' active':'');
    el.innerHTML=`<div style="font-weight:700">${g.id}</div><div class="muted" style="margin-top:2px">${g.label}</div>`;
    el.onclick=()=>{selectedGrade=g.label; mountGrades()};
    box.appendChild(el);
  })
}
function mountSubjects(){
  const box=document.getElementById('subjList'); box.innerHTML='';
  SUBJECTS.forEach(name=>{
    const el=document.createElement('div');
    el.className='subject'+(selectedSubjects.includes(name)?' active':'');
    el.textContent=name;
    el.onclick=()=>{
      if(selectedSubjects.includes(name)) selectedSubjects=selectedSubjects.filter(x=>x!==name);
      else selectedSubjects=[...selectedSubjects,name];
      mountSubjects()
    };
    box.appendChild(el);
  })
}
function mountRatings(){
  const box=document.getElementById('ratingList'); box.innerHTML='';
  selectedSubjects.forEach(name=>{
    const row=document.createElement('div'); row.className='card';
    const val=ratings[name]||3;
    row.innerHTML=`<div style="display:flex;align-items:center;gap:8px;justify-content:space-between">
      <div><b>${name}</b></div>
      <div>${[1,2,3,4,5].map(r=>`<button data-name="${name}" data-r="${r}" class="btn" style="margin-inline:2px;${r===val?'background:var(--green);color:#fff;border-color:var(--green)':''}">${r}</button>`).join('')}</div>
    </div>`;
    row.onclick=e=>{
      const r=parseInt(e.target.getAttribute('data-r'));
      const nm=e.target.getAttribute('data-name');
      if(!r||!nm) return;
      ratings[nm]=r; mountRatings();
    };
    box.appendChild(row);
  })
}
document.getElementById('next0').onclick=()=> step(1);
document.getElementById('back1').onclick=()=> step(0);
document.getElementById('next1').onclick=()=> step(2);
document.getElementById('back2').onclick=()=> step(1);
document.getElementById('next2').onclick=()=> step(3);
document.getElementById('back3').onclick=()=> step(2);
document.getElementById('minutes').oninput=e=> document.getElementById('minVal').textContent=e.target.value;
document.getElementById('finish').onclick=()=>{
  const subs = selectedSubjects.map(name=>({
   
